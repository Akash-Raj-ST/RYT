{%load static%}
<div class="add_review_container flex column center" style="display: none;">
    <form action="add_review" method="POST" enctype="multipart/form-data" class="flex column center upload_form">
      {% csrf_token %}
      <div id="upload-area" class="flex column center">
        <div id="gallery" class="flex row center"></div>
        <input type="file" name="images" id="fileElem" multiple accept="image/*" onchange="handleFiles(this.files)">
        <label class="button" for="fileElem">Add images</label>
      </div>
      
      <div class="content_upload flex center">
          <textarea name="content" cols="50" rows="10" class="input_field" placeholder="Share your Experience"></textarea>
      </div>
      <div class="tag_upload flex center">
          <textarea oninput="show_tag(this)" id="rev_tag" name="tags" cols="50" rows="10" class="input_field" placeholder="Tags...">#</textarea>
      </div>
      <button class="button center" type="submit">Submit</button>
    </form>
</div>

<script> 
  function handleFiles(files) {
    files = [...files]
    files.forEach(previewFile)
  }

  function previewFile(file) {
    let reader = new FileReader()
    reader.readAsDataURL(file)
    reader.onloadend = function() {
      let img = document.createElement('img')
      img.src = reader.result
      document.getElementById('gallery').appendChild(img)
    }
  }

  tag = document.querySelector("#rev_tag");
  tag.addEventListener('keydown', function(event) {
    const key = event.key; // const {key} = event; ES6+
    if (key === "Backspace") {
      tag.value = tag.value.substring(0,tag.length-2).trim();
    }
    if(tag.length==0){
      tag.value = "#";
      return;
    }
  });

  function show_tag(e){
    
    var len = e.value.length;
    if(len==0){
      e.value = "#";
      return;
    }

    if(e.value[len-1]==" "){
      e.value += "#";
    }
  }
</script>